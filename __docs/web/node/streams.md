# Nodejs Streams

参考文章: [nodejs streams post link](https://www.freecodecamp.org/news/node-js-streams-everything-you-need-to-know-c9141306be93/)


## 什么是Stream
stream就是一个无限的数据流，和数组这样有确定大小的数据结构不同，你一开始并不会知道数据流会流到什么时候，数据量有多大。这适用于打开一个文件或者网络链接传递数据的时候，因为没有办法一开始知道数据量有多大，所以stream这样一个抽象就可以让我们一块一块儿(chunk)的从中读取数据，直到读取结束（读取到结束标志）。

如果不是使用流的方式来读取的话，你IO的方式就是先将数据全部加载到内存当中，然后全部一起进行处理。如果是遇到非常大的文件，已经超过了你的内存大小，这样的文件就无法直接处理了; 同时，即使内存还够，你也需要等待所有数据加载完成才能开始进行处理，而非边加载边处理（如同下载电影和在线播放的方式）。使用流的方式，你不需要知道你要处理多少数据，因为你可以一小块一小块儿的处理，CPU也能更高效的被利用起来，而不是一直空等待到所有数据加载完。

## Pipe的概念
pipe的概念出自unix，pipe的作用就是将一个程序的输出传递给另一个程序作为输入。

在Node中，将stream的概念和pipe的概念结合就非常有意思了。stream让我们无需知道数据源有多大，反正它在stream这里就会被拆分成我们容易出来的许多小块儿的chunk，将每个chunk输出导入到其他程序中进行处理，如同流水线一般，最终输出的结果就是经过各项处理然后重组起来的数据



## Nodejs中的Stream类型
nodejs中一共有4种类型的stream：
- Readable : 其数据可以被消费的数据源抽象
- Writable : 可以被写入的目的地抽象
- Duplex : 既可读又可写的流
- Transform : 可以看做是一个能够在读和写的过程中修改或变换数据的 duplex 流。（也就是除了duplex的功能，还有附加的可以修改数据流的功能）

需要注意的是：所有的流都是EventEmitter的实例。

## 可读流的Paused和Flowing状态
一个可读流主要有两种类型的状态：Paused和Flowing。一般情况下，这两个状态的切换都是自动进行的。当可读流处于paused状态的时候，可以使用read按需读取，如果是flowing状态就需要使用data事件去消耗它的数据了。事实上，当添加data事件监听器的时候就会将流的状态从 paused切换到flowing，去掉data监听器，就会掐换到paused状态。也可以手动使用 resume() 和pause()函数来进行切换

